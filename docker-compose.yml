version: '2'

services:
  # run ad hoc commands
  solo-api: 
    image: gcr.io/solo-infrastructure/solo-platform-api:0.8.0
    volumes:
      - ./api.config.yml:/app/config/config.yml

  # run the api server w/ docs
  solo-api-server:
    extends: solo-api
    command: ["api-server"]
    ports:
      - 5000:80
  
  # database dependency for api server
  postgres:
    image: postgres:9.6-alpine
    environment:
      POSTGRES_USER: solo-platform
      POSTGRES_PASSWORD: solo-platform-db-password
      POSTGRES_DB: solo-platform

  # for viewing/debugging raw data in postgres
  adminer:
    image: adminer
    links:
      - postgres:postgres
    ports:
      - 5001:8080
  
  # for viewing the api docs
  swaggerui:
    image: swaggerapi/swagger-ui
    ports:
      - 5002:8080
    environment:
       API_URL: ${API_URL} 

 # to enable gcloud login for pushing/pulling images from GCP
  gcp:
    image: google/cloud-sdk:178.0.0-alpine
    volumes:
      - gcp-data-volume:/root/.config
      - ./.gcp:/root/gcp
volumes:
  gcp-data-volume: {}
